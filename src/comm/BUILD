config_setting(
    name = "windows",
    values = { "cpu": "x64_windows" }
)
config_setting(
    name = "msvc",
    values = { "cpu": "x64_windows_msvc" }
)
config_setting(
    name = "msys",
    values = { "cpu": "x64_windows_msys" }
)


cc_library(
    name = "hdrs",
    alwayslink = True,
    linkstatic = True,
    copts = ["-Isrc"]
    + select({":windows": [],
              ":msvc": [],
              ":msys": [],
              "//conditions:default": ["-std=c11"]}),
    hdrs = ["caqueueingthread.h"],
    visibility = ["//visibility:public"]
)

cc_library(
    name = "ifcontrol",
    alwayslink = True,
    linkstatic = True,
    copts = ["-Isrc",
             "-Iexternal/openocf/src",
             "-Isrc/comm",
             "-Iexternal/openocf/src/comm",
             "-Isrc/comm/transport/util",
             "-Iexternal/openocf/src/comm/transport/util",
             "-Isrc/comm/api",
             "-Iexternal/openocf/src/comm/api",
             "-Isrc/comm/common",
             "-Iexternal/openocf/src/comm/common",
             "-Isrc/comm/interface",
             "-Iexternal/openocf/src/comm/interface",
             "-Isrc/comm/transport/udpip",
             "-Iexternal/openocf/src/comm/transport/udpip",
             "-Isrc/comm/util",
             "-Iexternal/openocf/src/comm/util",
             "-Isrc/logger",
             "-Iexternal/openocf/src/logger",
             "-Isrc/portability",
             "-Iexternal/openocf/src/portability",
             "-Isrc/util",
             "-Iexternal/openocf/src/util",
             "-Ithird_party/coap/include",
             "-Iexternal/openocf/third_party/coap/include"]
    + select({":windows": [],
              ":msvc": [],
              ":msys": [],
              "//conditions:default": ["-std=c11"]}),
    deps = ["//src:config",
            "//src/comm/transport/util",
            "//src/comm/api",
            "//src/comm/common",
            "//src/comm:hdrs",
            "//src/comm/interface",
            "//src/comm/transport/udpip", # FIXME: select for this
            "//src/comm/util",
            "//src/logger",
            "//src/portability",
            "//src/util",
            "//third_party/coap"],
    srcs  = ["cainterfacecontroller.c",
	     "cainterfacecontroller.h",
             "caedradapter.h",
             "caleadapter.h",
             "canfcadapter.h",
             # "caqueueingthread.h",
             "canetworkconfigurator.h"],
    # visibility = ["//src/comm/transport:__subpackages__"]
)

cc_library(
    name = "comm",
    # alwayslink = True,
    linkstatic = 1,
    copts = ["-Isrc",
             "-Iexternal/openocf/src",
             "-Isrc/comm",
             "-Iexternal/openocf/src/comm",
             "-Isrc/comm/api",
             "-Iexternal/openocf/src/comm/api",
             "-Isrc/comm/transport/util",
             "-Iexternal/openocf/src/comm/transport/util",
	     "-Isrc/comm/common",
             "-Iexternal/openocf/src/comm/common",
	     "-Isrc/comm/include",
             "-Iexternal/openocf/src/comm/include",
	     "-Isrc/comm/interface",
             "-Iexternal/openocf/src/comm/interface",
	     "-Isrc/comm/security",
             "-Iexternal/openocf/src/comm/security",
             "-Isrc/comm/util",
             "-Iexternal/openocf/src/comm/util",
             # FIXME: select for this:
             "-Isrc/comm/transport/udpip",
             "-Iexternal/openocf/src/comm/transport/udpip",
             "-Isrc/logger",
             "-Iexternal/openocf/src/logger",
             "-Isrc/portability",
             "-Iexternal/openocf/src/portability",
             "-Isrc/util",
             "-Iexternal/openocf/src/util",
             "-Ithird_party/coap/include",
             "-Iexternal/openocf/third_party/coap/include",
             "-Ithird_party/mbedtls/include"]
    + select({":windows": [],
              ":msvc": [],
              ":msys": [],
              "//conditions:default": ["-std=c11"]}),
    deps = ["//src:config",
            "//src/logger",
    	    "//src/portability",
            "//src/comm/api",
            "//src/comm/transport/util",
	    "//src/comm/common",
	    "//src/comm:ifcontrol",
	    "//src/comm/interface",
	    "//src/comm/security",
            # FIXME: select for this
            "//src/comm/transport/udpip",
            "//third_party/coap",
            "//third_party/mbedtls",
            "//third_party/mbedtls:mbedtls-crypto",
            "//third_party/mbedtls:mbedtls-x509"],
    # hdrs = ["casecurityinterface.h"],
    srcs = ["cablockwisetransfer.c", # transport ALL or IP
            "cablockwisetransfer.h",
            "caconnectivitymanager.c",
            "caedradapter.h",
            "caleadapter.h",
            "canfcadapter.h",
            "caraadapter.h",
	    "camessagehandler.c",
	    "camessagehandler.h",
	    "canetworkconfigurator.c",
            "canetworkconfigurator.h",
	    "caprotocolmessage.c",
            "caqueueingthread.c",
            "caqueueingthread.h",
	    "caretransmission.c",
	    "caretransmission.h"],
    visibility = ["//visibility:public"]
)
