config_setting(
    name = "windows",
    values = { "define": "platform=windows" }
)

cc_library(
    name = "utility",
    copts = ["-Isrc",
             # "-Isrc/comm",  # comm/inc/pkix
             "-Isrc/comm/api",
             # "-Isrc/comm/common",
             # "-Isrc/comm/interface",
             # "-Isrc/comm/include",
             "-Isrc/logger",
             "-Isrc/ocf",
             # "-Isrc/ocf/internal",
             "-Isrc/portability",
             "-Isrc/provisioning/include",
             "-Isrc/util",
             "-Isrc/sec",
             "-Isrc/sec/security",
             "-Ithird_party/tinycbor/src",
             # "-Ithird_party/cjson",
             "-Ithird_party/coap/include",
             #"-Ithird_party/asn1cert",
             "-Ithird_party/mbedtls/include",
             "-Ithird_party/sqlite3"]
    + select({"windows": [],
              "//conditions:default": ["-std=c11"]}),
    deps = ["//src:config",
            "//src/comm",
            "//src/comm/api",
            "//src/comm/interface",
            "//src/logger",
            "//src/ocf:interface",
            #?  "//src/ocf",
            "//src/portability",
            "//src/sec:interface",
            "//src/sec/doxm",
            "//src/util",
            "//third_party/coap",
            "//third_party/mbedtls",
            "//third_party/tinycbor",
    ]
    + select({"windows": ["//third_party/sqlite3"],
              "//conditions:default": []}),
    hdrs = ["include/pmtypes.h",
            "include/pmutility.h"],
    srcs = [
        # "credentialgenerator.c",
        # "credentialgenerator.h",
        # "ocprovisioningmanager.c",
        # "ocprovisioningmanager.h",
        # "otmcontextlist.c",
        # "otmcontextlist.h",
        # "ownershiptransfermanager.c",
        # "ownershiptransfermanager.h",
        # "oxmjustworks.c",
        # "oxmjustworks.h",
        # "oxmmanufacturercert.c",
        # "oxmmanufacturercert.h",
        # "oxmrandompin.c",
        # "oxmrandompin.h",
        "pmutility.c",
        "pmutilityinternal.h",
        # "provisioningdatabasemanager.c",
        # "provisioningdatabasemanager.h",
        # "secureresourceprovider.c",
        # "secureresourceprovider.h",

            # if MULTIPLE_OWNER
        #"multipleownershiptransfermanager.c",
        #"multipleownershiptransfermanager.h",
        #"oxmpreconfpin.c"

            # if WITH_TCP
        # "cloud/utils.c",
        # "cloud/crl.c",
        # "cloud/aclgroup.c",
        # "cloud/aclinvite.c",
        # "cloud/aclid.c",
        # "cloud/csr.c"
    ],
    visibility = ["//src/ocf:__pkg__",
                  "//src/sec:__pkg__"]
)

cc_library(
    name = "provisioning",
    copts = ["-Isrc",
             # "-Isrc/comm",  # comm/inc/pkix
             "-Isrc/comm/api",
             # "-Isrc/comm/common",
             # "-Isrc/comm/interface",
             # "-Isrc/comm/include",
             "-Isrc/logger",
             "-Isrc/ocf",
             # "-Isrc/ocf/internal",
             "-Isrc/portability",
             "-Isrc/provisioning/include",
             "-Isrc/util",
             "-Isrc/sec",
             "-Isrc/sec/security",
             "-Ithird_party/tinycbor/src",
             # "-Ithird_party/cjson",
             "-Ithird_party/coap/include",
             #"-Ithird_party/asn1cert",
             "-Ithird_party/mbedtls/include",
             "-Ithird_party/sqlite3"]
    + select({"windows": [],
              "//conditions:default": ["-std=c11"]}),
    deps = ["//src:config",
            "//src/comm",
            "//src/comm/api",
            "//src/comm/interface",
            "//src/logger",
            "//src/ocf:interface",
            #  "//src/ocf",
            "//src/portability",
            "//src/sec/doxm",
            "//src/sec:interface",
            "//src/sec:resources",
            "//src/util",
            "//third_party/coap",
            "//third_party/mbedtls",
            "//third_party/tinycbor",
    ]
    + select({"windows": ["//third_party/sqlite3"],
              "//conditions:default": []}),
    hdrs = ["include/pmtypes.h",
            "include/pmutility.h"],
    srcs = ["credentialgenerator.c",
            "credentialgenerator.h",
            "ocprovisioningmanager.c",
            "ocprovisioningmanager.h",
            "otmcontextlist.c",
            "otmcontextlist.h",
            "ownershiptransfermanager.c",
            "ownershiptransfermanager.h",
            "oxmjustworks.c",
            "oxmjustworks.h",

            "oxmmanufacturercert.c",
            "oxmmanufacturercert.h",

            "oxmrandompin.c",
            "oxmrandompin.h",
            "pmutility.c",
            "pmutilityinternal.h",
            "provisioningdatabasemanager.c",
            "provisioningdatabasemanager.h",
            "secureresourceprovider.c",
            "secureresourceprovider.h",

            # if MULTIPLE_OWNER
            #"multipleownershiptransfermanager.c",
            #"multipleownershiptransfermanager.h",
            #"oxmpreconfpin.c"
            #"oxmpreconfpin.h"

            # if WITH_TCP
            # "cloud/utils.c",
            # "cloud/crl.c",
            # "cloud/aclgroup.c",
            # "cloud/aclinvite.c",
            # "cloud/aclid.c",
            # "cloud/csr.c"
    ],
    visibility = ["//src/ocf:__pkg__",
                  "//src/sec/acl:__pkg__",
                  "//src/sec:__pkg__"]
    )
